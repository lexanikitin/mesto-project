(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function n(e){e.target.classList.contains("popup")&&o(e.target)}function r(e){e.classList.add("popup_opened"),e.addEventListener("mousedown",n),document.addEventListener("keydown",t)}function o(e){e.removeEventListener("mousedown",n),document.removeEventListener("keydown",t),e.classList.remove("popup_opened")}e.d({},{D:()=>J,B:()=>N});var c=document.querySelector(".element-template").content,a=document.querySelector(".elements"),l=document.querySelector(".popup-image"),i=document.querySelector(".popup-delete"),u=l.querySelector(".popup__image"),s=l.querySelector(".popup__image-name");function d(e,t,n,o,i,d){var v=function(e,t,n,o,a,i){var d=c.querySelector(".element").cloneNode(!0),v=d.querySelector(".element__image"),p=d.querySelector(".element__heading"),y=d.querySelector(".element__like-btn"),_=d.querySelector(".element__delete"),h=d.querySelector(".element__like-counter");return v.src=t,v.alt=e,p.textContent=e,y.addEventListener("click",f),a===i?_.addEventListener("click",m):_.remove(),v.addEventListener("click",(function(){return function(e,t){u.src=t,u.alt=e,s.textContent=e,r(l)}(e,t)})),d.id=n,h.textContent=o.length,o.some((function(e){return e._id===i}))&&y.classList.add("element__like-btn_active"),d}(e,t,n,o,i,d);a.prepend(v)}function m(e){i.dataset.deletedElement=e.target.closest(".element").id,r(i)}function f(e){e.target.classList.contains("element__like-btn_active")?J(e.target.closest(".element").id):N(e.target.closest(".element").id)}function v(e,t){document.getElementById(e).querySelector(".element__like-counter").textContent=t}var p={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"8cf18d1a-5438-4fe9-84de-67a8b7385fb6","Content-Type":"application/json"}};function y(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}var _,h=document.querySelector(".profile__name"),b=document.querySelector(".profile__subtitle"),S=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__avatar-block"),E=document.querySelector(".popup-avatar"),L=E.querySelector(".form"),C=document.querySelector("#avatar-link"),k=document.querySelector(".popup-profile"),g=document.querySelector("#name"),x=document.querySelector("#subtitle"),U=k.querySelector(".form"),A=document.querySelector(".profile__avatar"),B=document.querySelector(".popup-delete"),P=B.querySelector(".form"),T=document.querySelectorAll(".popup__close"),w=document.querySelector(".popup-element"),D=w.querySelector(".form"),O=document.querySelector("#element-name"),j=document.querySelector("#element-link"),I=document.querySelector(".profile__add-button");function N(e){var t;(t=e,fetch("".concat(p.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:p.headers}).then(y)).then((function(t){document.getElementById(e).querySelector(".element__like-btn").classList.add("element__like-btn_active"),v(e,t.likes.length)})).catch((function(e){console.error("Ошибка при сохранении лайка на сервере.",e)}))}function J(e){var t;(t=e,fetch("".concat(p.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:p.headers}).then(y)).then((function(t){document.getElementById(e).querySelector(".element__like-btn").classList.remove("element__like-btn_active"),v(e,t.likes.length)})).catch((function(e){console.error("Ошибка при удалении лайка на сервере.",e)}))}Promise.all([fetch("".concat(p.baseUrl,"/users/me"),{headers:p.headers}).then(y),fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then(y)]).then((function(e){h.textContent=e[0].name,b.textContent=e[0].about,A.src=e[0].avatar,_=e[0]._id,e[1].forEach((function(e){d(e.name,e.link,e._id,e.likes,e.owner._id,_)}))})).catch((function(e){console.error("Ошибка при загрузке данных с сервера.",e)})),q.addEventListener("click",(function(){r(E)})),S.addEventListener("click",(function(){r(k),g.value=h.textContent,x.value=b.textContent})),I.addEventListener("click",(function(){r(w)})),T.forEach((function(e){e.addEventListener("click",(function(e){o(e.target.closest(".popup"))}))})),U.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=g.value,n=x.value,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:t,about:n})}).then(y)).then((function(){h.textContent=g.value,b.textContent=x.value,o(k)})).catch((function(e){console.error("Ошибка при сохранении профиля.",e)})).finally((function(){e.submitter.textContent="Сохранить"}))})),D.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=O.value,n=j.value,fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:t,link:n})}).then(y)).then((function(e){d(O.value,j.value,e._id,[],e.owner._id,_),o(w)})).catch((function(e){console.error("Ошибка при сохранении профиля.",e)})).finally((function(){e.submitter.textContent="Создать",e.target.reset()}))})),P.addEventListener("submit",(function(e){var t;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=B.dataset.deletedElement,fetch("".concat(p.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:p.headers}).then(y)).then((function(){document.getElementById(B.dataset.deletedElement).remove(),o(B)})).catch((function(e){console.error("Ошибка при удалении карточки.",e)})).finally((function(){e.submitter.textContent="Да",B.dataset.deletedElement=""}))})),L.addEventListener("submit",(function(e){var t;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=C.value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:t})}).then(y)).then((function(e){A.src=e.avatar,o(E)})).catch((function(e){console.error("Ошибка при загрузке нового аватара.",e)})).finally((function(){e.submitter.textContent="Сохранить",e.target.reset()}))})),function(e){var t=e.formSelector,n=e.inputSelector,r=e.submitButtonSelector,o=e.inactiveButtonClass,c=e.inputErrorClass,a=e.errorClass;function l(e,t){t.some((function(e){return!e.validity.valid}))?(e.classList.add(o),e.setAttribute("disabled","disabled")):(e.classList.remove(o),e.removeAttribute("disabled"))}Array.from(document.querySelectorAll(t)).forEach((function(e){var o=Array.from(e.querySelectorAll(n)),i=e.querySelector(r);l(i,o),e.addEventListener("reset",(function(){setTimeout((function(){l(i,o)}),0)})),o.forEach((function(e){e.addEventListener("input",(function(){(function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(e){e.classList.remove(c);var n=e.closest(t).querySelector(".".concat(e.id,"-error"));n.textContent="",n.classList.remove(a)}(e):function(e){e.classList.add(c);var n=e.closest(t).querySelector(".".concat(e.id,"-error"));n.textContent=e.validationMessage,n.classList.add(a)}(e)})(e),l(i,o)}))}))}))}({formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_state_error",errorClass:"form__error-message_visible"})})();