(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}function n(e){e.target.classList.contains("popup")&&r(e.target)}function o(e){e.classList.add("popup_opened"),e.addEventListener("mousedown",n),document.addEventListener("keydown",t)}function r(e){e.removeEventListener("mousedown",n),document.removeEventListener("keydown",t),e.classList.remove("popup_opened")}e.d({},{D:()=>J,B:()=>N});var c=document.querySelector(".element-template").content,a=document.querySelector(".elements"),s=document.querySelector(".popup-image"),i=document.querySelector(".popup-delete"),u=s.querySelector(".popup__image"),l=s.querySelector(".popup__image-name");function d(e,t,n,r,i,d){var v=function(e,t,n,r,a,i){var d=c.querySelector(".element").cloneNode(!0),v=d.querySelector(".element__image"),p=d.querySelector(".element__heading"),h=d.querySelector(".element__like-btn"),y=d.querySelector(".element__delete"),_=d.querySelector(".element__like-counter");return v.src=t,v.alt=e,p.textContent=e,h.addEventListener("click",f),a===i?y.addEventListener("click",m):y.remove(),v.addEventListener("click",(function(){return function(e,t){u.src=t,u.alt=e,l.textContent=e,o(s)}(e,t)})),d.id=n,_.textContent=r.length,r.some((function(e){return e._id===i}))&&h.classList.add("element__like-btn_active"),d}(e,t,n,r,i,d);a.prepend(v)}function m(e){i.dataset.deletedElement=e.target.closest(".element").id,o(i)}function f(e){e.target.classList.contains("element__like-btn_active")?(e.target.classList.remove("element__like-btn_active"),J(e.target.closest(".element").id)):(e.target.classList.add("element__like-btn_active"),N(e.target.closest(".element").id))}function v(e,t){document.getElementById(e).querySelector(".element__like-counter").textContent=t}var p,h={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"8cf18d1a-5438-4fe9-84de-67a8b7385fb6","Content-Type":"application/json"}},y=document.querySelector(".profile__name"),_=document.querySelector(".profile__subtitle"),b=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__avatar-block"),q=document.querySelector(".popup-avatar"),E=q.querySelector(".form"),k=document.querySelector("#avatar-link"),L=document.querySelector(".popup-profile"),C=document.querySelector("#name"),g=document.querySelector("#subtitle"),x=L.querySelector(".form"),j=document.querySelector(".profile__avatar"),P=document.querySelector(".popup-delete"),U=P.querySelector(".form"),A=document.querySelectorAll(".popup__close"),T=document.querySelector(".popup-element"),w=T.querySelector(".form"),B=document.querySelector("#element-name"),D=document.querySelector("#element-link"),O=document.querySelector(".profile__add-button");function N(e){var t;(t=e,fetch("".concat(h.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:h.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}))).then((function(t){v(e,t.likes.length)})).catch((function(e){console.error("Ошибка при сохранении лайка на сервере.",e)}))}function J(e){var t;(t=e,fetch("".concat(h.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:h.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}))).then((function(t){v(e,t.likes.length)})).catch((function(e){console.error("Ошибка при удалении лайка на сервере.",e)}))}fetch("".concat(h.baseUrl,"/users/me"),{headers:h.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).then((function(e){y.textContent=e.name,_.textContent=e.about,j.src=e.avatar,p=e._id})).catch((function(e){console.error("Ошибка при получении данных пользователя.",e)})),fetch("".concat(h.baseUrl,"/cards"),{headers:h.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).then((function(e){e.forEach((function(e){d(e.name,e.link,e._id,e.likes,e.owner._id,p)}))})).catch((function(e){console.error("Ошибка при получении карточек.",e)})),S.addEventListener("click",(function(){o(q)})),b.addEventListener("click",(function(){o(L),C.value=y.textContent,g.value=_.textContent})),O.addEventListener("click",(function(){o(T)})),A.forEach((function(e){e.addEventListener("click",(function(e){r(e.target.closest(".popup"))}))})),x.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=C.value,n=g.value,fetch("".concat(h.baseUrl,"/users/me"),{method:"PATCH",headers:h.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}))).then((function(){y.textContent=C.value,_.textContent=g.value})).catch((function(e){console.error("Ошибка при сохранении профиля.",e)})).finally((function(){r(L),e.submitter.textContent="Сохранить"}))})),w.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=B.value,n=D.value,fetch("".concat(h.baseUrl,"/cards"),{method:"POST",headers:h.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}))).then((function(e){d(B.value,D.value,e._id,[],e.owner._id,p)})).catch((function(e){console.error("Ошибка при сохранении профиля.",e)})).finally((function(){r(T),e.submitter.textContent="Создать",e.target.reset()}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=P.dataset.deletedElement,fetch("".concat(h.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:h.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}))).then((function(){document.getElementById(P.dataset.deletedElement).remove()})).catch((function(e){console.error("Ошибка при удалении карточки.",e)})).finally((function(){r(P),e.submitter.textContent="Да",P.dataset.deletedElement=""}))})),E.addEventListener("submit",(function(e){var t;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=k.value,fetch("".concat(h.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:h.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))}))).then((function(e){j.src=e.avatar})).catch((function(e){console.error("Ошибка при загрузке нового аватара.",e)})).finally((function(){r(q),e.submitter.textContent="Сохранить",e.target.reset()}))})),function(e){var t=e.formSelector,n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,c=e.inputErrorClass,a=e.errorClass;function s(e,t){t.some((function(e){return!e.validity.valid}))?(e.classList.add(r),e.setAttribute("disabled","disabled")):(e.classList.remove(r),e.removeAttribute("disabled"))}Array.from(document.querySelectorAll(t)).forEach((function(e){var r=Array.from(e.querySelectorAll(n)),i=e.querySelector(o);s(i,r),e.addEventListener("reset",(function(){setTimeout((function(){s(i,r)}),0)})),r.forEach((function(e){e.addEventListener("input",(function(){(function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(e){e.classList.remove(c);var n=e.closest(t).querySelector(".".concat(e.id,"-error"));n.textContent="",n.classList.remove(a)}(e):function(e){e.classList.add(c);var n=e.closest(t).querySelector(".".concat(e.id,"-error"));n.textContent=e.validationMessage,n.classList.add(a)}(e)})(e),s(i,r)}))}))}))}({formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_state_error",errorClass:"form__error-message_visible"})})();